{% load staticfiles %}
<!DOCTYPE html>
<html>
    <head>
        <title>sou</title>
        <meta charset="utf-8">
        <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
        <script src="{% static 'script/datepicker/js/jquery.ui.core.js' %}"></script>
        <script src="{% static 'script/datepicker/js/jquery.ui.datepicker.js' %}"></script>
        <script src="{% static 'script/datepicker/js/jquery.ui.widget.js' %}"></script>
        <script src="{% static 'script/datepicker/js/jquery-migrate-1.0.0.js' %}"></script>
        <!-- jqGrid插件包-必要 -->
        <script src="{% static 'script/jqgrid/js/jquery.jqGrid.min.js' %}"></script>
		<!-- jqGrid插件的多语言包-非必要 -->
        <script src="{% static 'script/jqgrid/js/i18n/grid.locale-cn.js' %}"></script>
		<!-- jqGrid组件基础样式包-必要 -->
        <link rel="stylesheet" type="text/css" href="{% static 'script/jqgrid/css/ui.jqgrid.css' %}">
		<!-- jqGrid主题包-非必要 --> 
        <link rel="stylesheet" type="text/css" href="{% static 'script/jqgrid/css/ui-lightness/jquery-ui-1.8.16.custom.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'script/datepicker/css/jquery.ui.datepicker.css' %}">
        <script>
            var SourceData
            function Bind(data){
                $("#tabShowData").jqGrid('clearGridData')
                $("#tabShowData").jqGrid('setGridParam',{
                    datatype: 'local',
                    data: data,
                    loadComplete: function(){
                        alert('datas ok')
                    }
                }).trigger('reloadGrid')
            }
            
            $(document).ready(function(){
                var searchTemplate1 = {
                    "groupOp": "AND",
                    "rules": [
                        { "field": "jobName", "op": "cn", "data": "测试"},
                        { "field": "jobName", "op": "nc", "data": "经理"},
                        { "field": "jobName", "op": "nc", "data": "主管"},
                        // { "field": "company_name", "op": "nc", "data": "外包公司"},
                        { "field": "jobNmoneyMiname", "op": "ge", "data": "11000"},
                        { "field": "workInfo", "op": "nc", "data": "外包"},
                    ]
                }
                $("#tabShowData").jqGrid({
                    // data:data,
                    datatype: "local",
                    // colNames:['ID','标题名','LOGO','公司','工作地址','职位福利','工资下限','工资上限','学历','职位描述','公司概括','时间','超链接'],
                    colModel:[
                        {label:'ID', name:'ID', width:'5%', search:false},
                        {label:'标题名', name:'jobName', align:'center', width:"30%", searchoptions:{sopt:['cn','nc']}},
                        {label:'LOGO', name:'company_logo', width:'5%', search:false, formatter: function(cellValue, options, rowObject){
                            return '<a href="http://' + rowObject['company_url'] + '" target="_black"><img src="' + cellValue + '" style="height:50px;width:50px"></a>'
                        }},
                        {label:'公司', name:'company_name', width:"30%", searchoptions:{sopt:['cn','nc']}, formatter: function(value, opt, row){
                            return '<span title="' + row['company_size'] + '">' + value + '</span>'
                        }},
                        {label:'工作地址', name:'work_address', width:"30%", searchoptions:{sopt:['cn']}, formatter: function(value, opt, row){
                            return '<span title="' + row['company_address'] + '">' + value + '</span>'
                        }},
                        {label:'职位福利', name:'welfare', width:"30%", searchoptions:{sopt:['cn']}},
                        {label:'工资下限', name:'moneyMin', align:'center', width:"20%", sorttype:'number', searchoptions:{
                            sopt:['le', 'ge'],
                        }},
                        {label:'工资上限', name:'moneyMax', align:'center', width:"20%", sorttype:'number', searchoptions:{
                            sopt:['le', 'ge'],
                        }},
                        {label:'学历', name:'eduLevel', align:'center', width:"20%", stype:'select', searchoptions:{sopt:['cn'], value:":[全部];专:专;本:本"}},
                        {label:'职位描述', name:'jobInfo', width:"10%", search:false},
                        {label:'公司概括', name:'workInfo', width:"10%", searchoptions:{sopt:['nc']}},
                        {label:'时间', name:'updateDate', width:"20%", searchoptions:{sopt:['lt', 'gt'], dataInit: function(element){
                            $(element).datepicker({dateFormat:'yy-mm-dd 00:00:00'})
                        }}},
                        {label:'超链接', name:'positionURL', width:"10%", search:false},
                    ],
                    height: $(window).height()*0.8,
                    viewrecords: true,//是否在浏览导航栏显示记录总数
                    altRows: true,//设置为交替行表格,默认为false
                    // toppager: true,//是否在上面显示浏览导航栏
                    multiselect: true,//是否多选
                    multiboxonly: true,//是否只能点击复选框多选
                    //sortname:'id',//默认的排序列名
                    //sortorder:'asc',//默认的排序方式（asc升序，desc降序）
                    caption: "智联工作表",//表名
                    autowidth: true,//自动宽
                    // scroll:1,
                    multiSort: true,
                    caption: "HIDE",
                    
                    pager: '#divPaper',//分页、按钮所在的浏览导航栏
                    rowNum: 100,//每页显示记录数
                    rowList: [50, 100, 200, 1000],//用于改变显示行数的下拉列表框的元素数组。
                })
                $("#tabShowData").navGrid("#divPaper", {
                    add: false,
                    del: false,
                    edit: false,
                    search: true,
                    refresh: true
                },
                {}, // edit options
                {}, // add options
                {}, // delete options
                {multipleSearch: true, multipleGroup:true, showQuery: true, 'tmplNames': ["测试"], 'tmplFilters': [searchTemplate1]})
                $("#tabShowData").jqGrid('filterToolbar', {searchOperators : true})

                $(window).resize(function(){  
                    $("#tabShowData").setGridWidth($(window).width())
                    $("#tabShowData").setGridHeight($(window).height()*0.8)
                });  

                $("#sel").click(function(){
                    $.ajax({
                        type:'get',
                        url:'Queryjob',
                        data: {
                            "job":$("#job").val(),
                            'money_interval':$("#money_interval").val(),
                            "count":$("#count").val(),
                        },
                        success: function(data){
                            // console.log(data)
                            SourceData = data
                            Bind(data)
                        }
                    })
                })

                $("#open_link").click(function(){
                    var sel_ids = $("#tabShowData").jqGrid('getGridParam','selarrrow')
                    for (var i in sel_ids){
                        var row = $("#tabShowData").jqGrid('getRowData', sel_ids[i])
                        window.open(row.positionURL)
                    }
                })

                $("#filter").click(function(){
                    // var rows = $("#tabShowData").jqGrid('getRowData')
                    // var rows = $("#divShowData").datagrid('getRows')
                    var keyword = $.trim($("#green_channel").val())
                    var block_words = $("#block_job").val().split(' ')
                    var black_list = $("#block_company").val().split(' ')
                    var white_list = $("#white_list").val().split(' ')
                    // console.log(keyword, block_words, black_list)
                    var newData = []
                    for (var sdi in SourceData){
                        var isFilter = true
                        var row = SourceData[sdi]
                        if (row['jobName'].indexOf(keyword) == -1){
                            isFilter = false
                        }

                        if (isFilter && $.trim($("#block_job").val()) != ''){
                            for (var bwj in block_words){
                                if (row['jobName'].indexOf(block_words[bwj]) != -1){
                                    isFilter = false
                                    // console.log(row['jobName'], block_words[bwj])
                                    break
                                }
                            }
                        }

                        if (isFilter && $.trim($("#block_company").val()) != ''){
                            for (var blj in black_list){
                                if (row['company_name'].indexOf(black_list[blj]) != -1){
                                    isFilter = false
                                    // console.log(row['company_name'], black_list[blj])
                                    break
                                }
                            }                            
                        }

                        if (isFilter && $.trim($("#white_list").val()) != ''){
                            var address
                            if (row['work_address'].length > row['company_address'].length){
                                address = row['work_address']
                            }else{
                                address = row['company_address']
                            }
                            for (var wlj in white_list){
                                if (address.indexOf(white_list[wlj]) == -1){
                                    isFilter = false
                                }else{
                                    isFilter = true
                                    break
                                }
                            }
                        }

                        if (isFilter){
                            newData.push(row)
                        }
                    }
                    // console.log(newData)
                    Bind(newData)
                })
            })
        </script>
        <style>
            .ui-jqgrid tr.jqgrow td {
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .ui-jqgrid .ui-jqgrid-htable .ui-th-div {
                height: 30px;
            }
            .ui-jqgrid .ui-pg-selbox {
                height: 30px;
            }
        </style>
    </head>
    <body>
        JobName<input id="job" type="text">
        MoneyInterval<select id="money_interval" type="down">
            <option value="1,10000">全部</option>            
            <option value="6001,8000">6K-8K</option>
            <option value="8001,10000">8K-10K</option>
            <option value="10001,15000">10K-15K</option>
            <option value="15001,25000">15K-25K</option>
            <option value="25001,35000">25K-35K</option>
        </select>
        Count<input id="count" type="text">
        <button id="sel">查询</button>
        <!-- <button id="selConditional">条件查询</button> -->
        <button id="open_link">打开职位链接</button><br>
        <!-- Keyword<input id="green_channel" type="text">
        WorkAddress<input id="white_list" type="text">
        BlockJob<input id="block_job" type="text">
        BlockCompany<input id="block_company" type="text">
        <button id="filter">筛选</button> -->
        <table id="tabShowData"></table>
        <div id="divPaper"></div>
    </body>
</html>